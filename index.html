<html>
	<!-- navbar -->
	<head>
		<title> waitLess </title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
		<script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<style type="text/css">
		    .jumbotron {
		        background: #532f8c;
		        color: white;
		        padding-bottom: 80px
		    }
		    .jumbotron .btn-primary {
		        background: #845ac7;
		        border-color: #845ac7
		    }
		    .jumbotron .btn-primary:hover {
		        background: #7646c1
		    }
		    .jumbotron p {
		        color: #d9ccee;
		        max-width: 75%;
		        margin: 1em auto 2em
		    }
		    .navbar+.jumbotron {
		        margin-top: -20px
		    }
		    .jumbotron .lang-logo {
		        display: block;
		        background: #b01302;
		        border-radius: 50%;
		        overflow: hidden;
		        width: 100px;
		        height: 100px;
		        margin: auto;
		        border: 2px solid white
		    }
		    .jumbotron .lang-logo img {
		        max-width: 100%
		    }
		</style>
	</head>

	<body>
		<nav class="navbar navbar-default navbar-static-top navbar-inverse">
			<div class="container">
				<ul class="nav navbar-nav">
					<li class="active">
						<a href="/"><span class="glyphicon glyphicon-home"></span> waitLess </a>
					</li>
					<li>
						<a href="https://waitlessprinceton.herokuapp.com/about"><span class="glyphicon glyphicon-info-sign"></span> About </a>
					</li>
					<li>
						<a href="https://waitlessprinceton.herokuapp.com/status"><span class="glyphicon glyphicon-bookmark"></span> Status </a>
					</li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li class="navbar-right">
						<a href="https://waitlessprinceton.herokuapp.com/accounts/logout/"><span class="glyphicon glyphicon-book"></span> Logout</a>
					</li>
				</ul>
			</div>
		</nav>
	</body>

	<!-- map -->
	<head>
		<!-- leaflet includes -->
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
		<link rel="stylesheet" href="//code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" type="text/css">
		<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
		
		<!-- chart generation script -->
	    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	    <script type="text/javascript"> 
	    	google.charts.load('current', {'packages':['corechart']});
	    	google.charts.setOnLoadCallback(drawChart);
	    </script>

		<!-- hover box and legend -->
		<style media="screen" type="text/css">
			.info {
				padding:6px 8px;
				font: 14px/16px Arial, Helvetica, sans-serif;
				background: white;
				background: rgba(255,255,255,0.8);
				box-shadow: 0 0 15px rgba(0,0,0,0.2);
				border-radius: 5px;
			}
			.info h4 {
				margin: 0 0 5px;
				color: #777;
			}
			.legend {
				line-height: 18px;
				color: #555;
			}
			.legend i {
				width: 18px;
				height: 18px;
				float: left;
				margin-right: 8px;
				opacity: 0.7;
			}
			.leaflet-bottom.leaflet-left{
			width: 100%;
		      }
		      .leaflet-control-container .leaflet-timeline-controls{
			box-sizing: border-box;
			width: 100%;
			margin: 0;
			margin-bottom: 15px;
			}
		</style>
	</head>
	
	<!-- map -->
	<body>
		<div id="mapid"></div>
		<style>
		#mapid {
			position: absolute;
			top: 50; right: 0; bottom: 0; left: 0;
		}
		</style>

		<script src="//code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="//code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
		<script src="SliderControl.js"></script>

		<script>
			// popup variables
			var popupId = 1;
	 		var chartId = "curve_chart" + popupId;

	 		// load map
            var campusMap = L.tileLayer('https://api.mapbox.com/styles/v1/waitlessprinceton/cj19oscmj00582tqnyb4sabtq/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoid2FpdGxlc3NwcmluY2V0b24iLCJhIjoiY2oweTF2ZG5rMDFqZjMzbzJnbWJ1MGxmcCJ9.M-_AnWBdd7urxxR2Ks-iUA', {
            		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
					maxZoom: 18,
					minZoom: 16,
			});
            var mymap = L.map('mapid', {
            	center: [40.346196, -74.656426],
            	zoom: 16,
            	layers: [campusMap]
            });
	                
	 		// building and occupancy data
	 		//{% block content %}
		 		var dillon1 = {"type":"FeatureCollection","generator":"overpass-turbo","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.","timestamp":"2017-04-08T16:21:02Z","features":[{"type":"Feature","id":"way/27341417","properties":{"@id":"way/27341417","building":"yes","leisure":"sports_centre","name":"Dillon Gym","density":100,"lat":40.345611,"long":-74.658797,"max":3665},"geometry":{"type":"Polygon","coordinates":[[[-74.6588761,40.3449764],[-74.6587394,40.3450124],[-74.6588541,40.3452652],[-74.6580229,40.3454842],[-74.6580752,40.3455993],[-74.6584226,40.3455078],[-74.6584742,40.3456216],[-74.658461,40.3456371],[-74.6584666,40.3456502],[-74.658484,40.3456601],[-74.6585038,40.3457056],[-74.658497,40.3457188],[-74.6585026,40.3457326],[-74.65852,40.3457394],[-74.6585409,40.3457345],[-74.6585494,40.3457188],[-74.6586053,40.3457042],[-74.658624,40.3457113],[-74.6586493,40.3457048],[-74.6588007,40.3460395],[-74.6587692,40.3460478],[-74.6588338,40.3461905],[-74.6588491,40.3461865],[-74.6588668,40.3462257],[-74.6592581,40.3461226],[-74.6592536,40.3461126],[-74.6592406,40.3460851],[-74.6592591,40.3460801],[-74.6592474,40.3460553],[-74.6591933,40.3459367],[-74.6591602,40.3459455],[-74.6591029,40.3458198],[-74.6591684,40.3458025],[-74.6591484,40.3457586],[-74.6590861,40.345775],[-74.658972,40.3455243],[-74.6591375,40.3454806],[-74.6590742,40.3453414],[-74.6590452,40.3453491],[-74.6588761,40.3449764]]]}}]};
				var dillon2 = {"type":"FeatureCollection","generator":"overpass-turbo","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.","timestamp":"2017-04-08T16:21:02Z","features":[{"type":"Feature","id":"way/27341417","properties":{"@id":"way/27341417","building":"yes","leisure":"sports_centre","name":"Dillon Gym","density":200,"lat":40.345611,"long":-74.658797,"max":3665},"geometry":{"type":"Polygon","coordinates":[[[-74.6588761,40.3449764],[-74.6587394,40.3450124],[-74.6588541,40.3452652],[-74.6580229,40.3454842],[-74.6580752,40.3455993],[-74.6584226,40.3455078],[-74.6584742,40.3456216],[-74.658461,40.3456371],[-74.6584666,40.3456502],[-74.658484,40.3456601],[-74.6585038,40.3457056],[-74.658497,40.3457188],[-74.6585026,40.3457326],[-74.65852,40.3457394],[-74.6585409,40.3457345],[-74.6585494,40.3457188],[-74.6586053,40.3457042],[-74.658624,40.3457113],[-74.6586493,40.3457048],[-74.6588007,40.3460395],[-74.6587692,40.3460478],[-74.6588338,40.3461905],[-74.6588491,40.3461865],[-74.6588668,40.3462257],[-74.6592581,40.3461226],[-74.6592536,40.3461126],[-74.6592406,40.3460851],[-74.6592591,40.3460801],[-74.6592474,40.3460553],[-74.6591933,40.3459367],[-74.6591602,40.3459455],[-74.6591029,40.3458198],[-74.6591684,40.3458025],[-74.6591484,40.3457586],[-74.6590861,40.345775],[-74.658972,40.3455243],[-74.6591375,40.3454806],[-74.6590742,40.3453414],[-74.6590452,40.3453491],[-74.6588761,40.3449764]]]}}]};
		 		var frist1 = {"type":"FeatureCollection","generator":"overpass-turbo","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.","timestamp":"2017-04-08T16:21:02Z","features":[{"type":"Feature","id":"way/27341386","properties":{"@id":"way/27341386","building":"university","name":"Frist Campus Center","operator":"Princeton University","wheelchair":"yes","density":100,"lat":40.346740,"long":-74.655142,"max":4836},"geometry":{"type":"Polygon","coordinates":[[[-74.6555801,40.3466183],[-74.6555912,40.34661],[-74.6555745,40.3465888],[-74.6556126,40.3465716],[-74.6555918,40.346545],[-74.6555533,40.3465617],[-74.6555253,40.3465258],[-74.6555092,40.3465304],[-74.6554264,40.3464243],[-74.6554052,40.3464331],[-74.6553859,40.3464083],[-74.6554514,40.3463783],[-74.6554278,40.3463492],[-74.6553492,40.3463847],[-74.6553387,40.3463713],[-74.6552991,40.3463903],[-74.6552791,40.3463669],[-74.6551691,40.3464192],[-74.6551557,40.3464006],[-74.6547558,40.3465817],[-74.6547692,40.3465995],[-74.6546161,40.3466699],[-74.6546423,40.3467011],[-74.6546249,40.3467101],[-74.6546502,40.3467429],[-74.6546924,40.3467264],[-74.6547093,40.3467487],[-74.6546588,40.346772],[-74.6547516,40.3468911],[-74.6547384,40.3468974],[-74.6547997,40.3469757],[-74.6548139,40.3469709],[-74.6549539,40.3471505],[-74.6550948,40.3470867],[-74.6550851,40.3470742],[-74.6551022,40.3470674],[-74.6551113,40.347045],[-74.6551035,40.3470352],[-74.6552664,40.3469614],[-74.6552794,40.3469783],[-74.6553676,40.3469385],[-74.6553536,40.3469219],[-74.6555104,40.3468509],[-74.6555185,40.346859],[-74.6555435,40.3468654],[-74.6555603,40.34686],[-74.6555697,40.3468721],[-74.6557219,40.3468031],[-74.6555801,40.3466183]]]}}]};
		 		var frist2 = {"type":"FeatureCollection","generator":"overpass-turbo","copyright":"The data included in this document is from www.openstreetmap.org. The data is made available under ODbL.","timestamp":"2017-04-08T16:21:02Z","features":[{"type":"Feature","id":"way/27341386","properties":{"@id":"way/27341386","building":"university","name":"Frist Campus Center","operator":"Princeton University","wheelchair":"yes","density":200,"lat":40.346740,"long":-74.655142,"max":4836},"geometry":{"type":"Polygon","coordinates":[[[-74.6555801,40.3466183],[-74.6555912,40.34661],[-74.6555745,40.3465888],[-74.6556126,40.3465716],[-74.6555918,40.346545],[-74.6555533,40.3465617],[-74.6555253,40.3465258],[-74.6555092,40.3465304],[-74.6554264,40.3464243],[-74.6554052,40.3464331],[-74.6553859,40.3464083],[-74.6554514,40.3463783],[-74.6554278,40.3463492],[-74.6553492,40.3463847],[-74.6553387,40.3463713],[-74.6552991,40.3463903],[-74.6552791,40.3463669],[-74.6551691,40.3464192],[-74.6551557,40.3464006],[-74.6547558,40.3465817],[-74.6547692,40.3465995],[-74.6546161,40.3466699],[-74.6546423,40.3467011],[-74.6546249,40.3467101],[-74.6546502,40.3467429],[-74.6546924,40.3467264],[-74.6547093,40.3467487],[-74.6546588,40.346772],[-74.6547516,40.3468911],[-74.6547384,40.3468974],[-74.6547997,40.3469757],[-74.6548139,40.3469709],[-74.6549539,40.3471505],[-74.6550948,40.3470867],[-74.6550851,40.3470742],[-74.6551022,40.3470674],[-74.6551113,40.347045],[-74.6551035,40.3470352],[-74.6552664,40.3469614],[-74.6552794,40.3469783],[-74.6553676,40.3469385],[-74.6553536,40.3469219],[-74.6555104,40.3468509],[-74.6555185,40.346859],[-74.6555435,40.3468654],[-74.6555603,40.34686],[-74.6555697,40.3468721],[-74.6557219,40.3468031],[-74.6555801,40.3466183]]]}}]};
		 	//{% endblock %}

	 		var gjDill1 = L.geoJson(dillon1, {style: style, onEachFeature: onEachFeature, time: "2013-01-22 08:42:26+01"});
	 		var gjDill2 = L.geoJson(dillon2, {style: style, onEachFeature: onEachFeature, time: "2013-01-22 10:03:29+01"});
			var gjFrist1 = L.geoJson(frist1, {style: style, onEachFeature: onEachFeature, time: "2013-01-22 08:42:26+01"});
	 		var gjFrist2 = L.geoJson(frist2, {style: style, onEachFeature: onEachFeature, time: "2013-01-22 10:03:29+01"});

            // set up layers
            var overlayMaps = {
            	"Frist": gjFrist1,
            	"Dillon": gjFrist2,
            };
            L.control.layers(null, overlayMaps, {position:'bottomleft'}).addTo(mymap);
            gjFrist1.addTo(mymap);
            gjDill1.addTo(mymap);
            
			// load hover box
			var info = L.control({position: 'topright'});
			info.onAdd = function(map) {
				this._div = L.DomUtil.create('div', 'info');
				this.update();
				return this._div;
			};
			info.update = function(props) {
				this._div.innerHTML = '<h4>Campus Building Traffic</h4>' + (props ? '<b>' + props.name + '</b><br />' + props.density + ' people' : 'Hover over a building');
			};
			info.addTo(mymap);

			// load slider
            layerGroup = L.layerGroup([gjFrist1, gjDill1, gjFrist2, gjDill2]);
			var sliderControl = L.control.sliderControl({position: "topright", layer:layerGroup, follow: 1});
			mymap.addControl(sliderControl);
			sliderControl.startSlider();

			// load legend
			var legend = L.control({position: 'bottomright'});
			legend.onAdd = function(map) {
				var div = L.DomUtil.create('div', 'info legend'),
				grades = [0, 20, 40, 60, 80, 100],
				labels = [];
				for (var i = 0; i < grades.length - 1; i++) {
					div.innerHTML += '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' + grades[i] + '&ndash;' + grades[i + 1] + '% <br>';
				}
				return div;
			};
			legend.addTo(mymap);

			// fill depends on density
			function style(feature) {
				var percentFull = feature.properties.density/feature.properties.max * 100;
				return {
					fillColor: getColor(percentFull),
					weight: 2,
					opacity: 1,
					color: 'white',
					dashArray: '3',
					fillOpacity: 0.7
				};
			}

			// assign color based on density
			function getColor(percentFull) {
				return percentFull > 80 ? '#E50000' :
				percentFull > 60 ? '#DB6300' :
				percentFull > 40 ? '#F9FB19' :
				percentFull > 20 ? '#80C800' :
				'#24BF00';
			}

			// add listeners
			function onEachFeature(feature, layer) {
				layer.on({
					mouseover: highlightFeature,
					mouseout: resetHighlight,
					click: showHistory
				});
			}

			// highlight
			function highlightFeature(e) {
				var layer = e.target;
				layer.setStyle({
					weight: 3,
					color: '#666',
					dashArray: '',
					fillOpacity: 0.7
				});
				if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
					layer.bringToFront();
				}
				info.update(layer.feature.properties);
			}

			// unhighlight
			function resetHighlight(e) {
				gj1.resetStyle(e.target);
				gj2.resetStyle(e.target);
				info.update();
			}

			// draw chart
			function drawChart(elem, name) {
				var t1 = Math.round(Math.random() * 1000);
				var t2 = Math.round(Math.random() * 1000);
				var t3 = Math.round(Math.random() * 1000);
				var t4 = Math.round(Math.random() * 1000);
				var t5 = Math.round(Math.random() * 1000);
				var t6 = Math.round(Math.random() * 1000);
				var t7 = Math.round(Math.random() * 1000);
				var t8 = Math.round(Math.random() * 1000);
				var t9 = Math.round(Math.random() * 1000);
				var t10 = Math.round(Math.random() * 1000);
				var t11 = Math.round(Math.random() * 1000);
				var t12 = Math.round(Math.random() * 1000);
				var t13 = Math.round(Math.random() * 1000);
				var t14 = Math.round(Math.random() * 1000);
				var t15 = Math.round(Math.random() * 1000);
				var t16 = Math.round(Math.random() * 1000);
				var t17 = Math.round(Math.random() * 1000);
				var t18 = Math.round(Math.random() * 1000);
				var t19 = Math.round(Math.random() * 1000);
				var t20 = Math.round(Math.random() * 1000);
				var t21 = Math.round(Math.random() * 1000);
				var t22 = Math.round(Math.random() * 1000);
				var t23 = Math.round(Math.random() * 1000);
				var t24 = Math.round(Math.random() * 1000);
				var t25 = Math.round(Math.random() * 1000);
				var data = google.visualization.arrayToDataTable([
					['Time', 'Traffic'],
					['8:00',  t1],
					['8:30',  t2],
					['9:00',  t3],
					['9:30',  t4],
					['10:00',  t5],
					['10:30',  t6],
					['11:00',  t7],
					['11:30',  t8],
					['12:00',  t9],
					['12:30',  t10],
					['1:00',  t11],
					['1:30', t12],
					['2:00', t13],
					['2:30', t14],
					['3:00', t15],
					['3:30', t16],
					['4:00', t17],
					['4:30', t18],
					['5:00', t19],
					['5:30', t20],
					['6:00', t21],
					['6:30', t22],
					['7:00', t23],
					['7:30', t24],
					['8:00', t25]
				]);
		    	var options = {
		    		title: 'Daily Traffic - ' + name,
		    		colors:['#E50000'],
		      		curveType: 'function',
		      		legend: {position: 'none'},
		      		chartArea: {width: '85%', height: '80%'},
		      		vAxis: {
		      			viewWindowMode: 'explicit',
		      			viewWindow: {
		      				min: 0
		      			}
		      		}
		    	};
		    	var container = document.getElementById(elem);
		    	var chart = new google.visualization.LineChart(container);
		    	chart.draw(data, options);
		  	}

			// generate popup with chart
			function showHistory(e) {
				var options = {
					maxWidth: 500
				};
				var prop = e.target.feature.properties;
				var chartId = "curve_chart" + popupId;
				var popup = L.popup(options)
					.setLatLng([prop.lat,prop.long])
    				.setContent('<div id="' + chartId + '" style="width: 500px; height: 300px"></div>')
    				.openOn(mymap);
			popupId++;
    			drawChart(chartId, prop.name);
			}
		</script>
	</body>
</html>